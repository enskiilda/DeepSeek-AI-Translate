{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/translate/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\n\nconst NVIDIA_API_KEY = \"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\";\nconst NVIDIA_BASE_URL = \"https://integrate.api.nvidia.com/v1\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { text, targetLang, sourceLang } = await request.json();\n\n    if (!text || !targetLang) {\n      return Response.json({ error: \"Missing required fields\" }, { status: 400 });\n    }\n\n    const prompt = `Translate the following text from ${sourceLang || \"auto-detect\"} to ${targetLang}. Only respond with the translation, no explanations:\\n\\n${text}`;\n\n    const response = await fetch(`${NVIDIA_BASE_URL}/chat/completions`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${NVIDIA_API_KEY}`,\n      },\n      body: JSON.stringify({\n        model: \"deepseek-ai/deepseek-v3.1\",\n        messages: [\n          { role: \"user\", content: prompt }\n        ],\n        temperature: 0.3,\n        stream: true\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      console.error(\"NVIDIA API Error:\", error);\n      return Response.json({ error: error.error?.message || \"Translation failed\" }, { status: response.status });\n    }\n\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      async start(controller) {\n        const reader = response.body?.getReader();\n        const decoder = new TextDecoder();\n\n        if (reader) {\n          let streamComplete = false;\n          while (!streamComplete) {\n            const { done, value } = await reader.read();\n            if (done) break;\n\n            const chunk = decoder.decode(value, { stream: true });\n            const lines = chunk.split(\"\\n\").filter(line => line.trim() !== \"\");\n\n            for (const line of lines) {\n              if (line.startsWith(\"data: \")) {\n                const data = line.slice(6);\n                if (data === \"[DONE]\") {\n                  controller.enqueue(encoder.encode(\"data: [DONE]\\n\\n\"));\n                  streamComplete = true;\n                  break;\n                }\n                try {\n                  const parsed = JSON.parse(data);\n                  const content = parsed.choices?.[0]?.delta?.content || \"\";\n                  if (content) {\n                    controller.enqueue(encoder.encode(`data: ${JSON.stringify({ content })}\\n\\n`));\n                  }\n                } catch (e) {\n                }\n              }\n            }\n          }\n        }\n        controller.close();\n      }\n    });\n\n    return new Response(stream, {\n      headers: {\n        \"Content-Type\": \"text/event-stream\",\n        \"Cache-Control\": \"no-cache\",\n        \"Connection\": \"keep-alive\",\n      },\n    });\n  } catch (error: any) {\n    console.error(\"Translation error:\", error);\n    return Response.json({ error: error.message || \"Internal server error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAEA,MAAM,iBAAiB;AACvB,MAAM,kBAAkB;AAEjB,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,UAAU,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,IAAI,CAAC,QAAQ,CAAC,YAAY;YACxB,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,SAAS,CAAC,kCAAkC,EAAE,cAAc,cAAc,IAAI,EAAE,WAAW,yDAAyD,EAAE,MAAM;QAElK,MAAM,WAAW,MAAM,MAAM,GAAG,gBAAgB,iBAAiB,CAAC,EAAE;YAClE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,gBAAgB;YAC7C;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBAAE,MAAM;wBAAQ,SAAS;oBAAO;iBACjC;gBACD,aAAa;gBACb,QAAQ;YACV;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,SAAS,IAAI,CAAC;gBAAE,OAAO,MAAM,KAAK,EAAE,WAAW;YAAqB,GAAG;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAC1G;QAEA,MAAM,UAAU,IAAI;QACpB,MAAM,SAAS,IAAI,eAAe;YAChC,MAAM,OAAM,UAAU;gBACpB,MAAM,SAAS,SAAS,IAAI,EAAE;gBAC9B,MAAM,UAAU,IAAI;gBAEpB,IAAI,QAAQ;oBACV,IAAI,iBAAiB;oBACrB,MAAO,CAAC,eAAgB;wBACtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,IAAI;wBACzC,IAAI,MAAM;wBAEV,MAAM,QAAQ,QAAQ,MAAM,CAAC,OAAO;4BAAE,QAAQ;wBAAK;wBACnD,MAAM,QAAQ,MAAM,KAAK,CAAC,MAAM,MAAM,CAAC,CAAA,OAAQ,KAAK,IAAI,OAAO;wBAE/D,KAAK,MAAM,QAAQ,MAAO;4BACxB,IAAI,KAAK,UAAU,CAAC,WAAW;gCAC7B,MAAM,OAAO,KAAK,KAAK,CAAC;gCACxB,IAAI,SAAS,UAAU;oCACrB,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC;oCAClC,iBAAiB;oCACjB;gCACF;gCACA,IAAI;oCACF,MAAM,SAAS,KAAK,KAAK,CAAC;oCAC1B,MAAM,UAAU,OAAO,OAAO,EAAE,CAAC,EAAE,EAAE,OAAO,WAAW;oCACvD,IAAI,SAAS;wCACX,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,KAAK,SAAS,CAAC;4CAAE;wCAAQ,GAAG,IAAI,CAAC;oCAC9E;gCACF,EAAE,OAAO,GAAG,CACZ;4BACF;wBACF;oBACF;gBACF;gBACA,WAAW,KAAK;YAClB;QACF;QAEA,OAAO,IAAI,SAAS,QAAQ;YAC1B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;YAChB;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,SAAS,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC1F;AACF"}}]
}